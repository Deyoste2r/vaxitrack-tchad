<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaxiTrack Tchad v2.0 | Suivi Vaccination Offline</title>
    
    <!-- METADONNEES OPTIMISEES -->
    <meta name="description" content="Application de suivi vaccinal offline pour agents de sant√© UNICEF Tchad">
    <meta name="theme-color" content="#0077c8">
    
    <!-- POLITIQUE DE CACHE MODEREE -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css?v=2.0">
    
    <!-- MANIFEST PWA -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ICONE -->
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkElEQVQ4jWP8//8/Ay0BE12MZ2BgYKC5C4yMjBgYGBgYqOqCvXv3Mv7//5+BioBqXqCqC1C9TzUv0MQFqN6nmhdo4gK8Lvj//z/D3r17GfGpIegCdN+jegGvC9A1o3uBwMjE7n2CLkD1PkEXoHpfpwtQvY/XBejex+sCdO/jdAGm9/G6AN37OF2A6X2cLsD0Pk4XYHofpwvQvY/TBbi8j9MF6N7H6QJc3sfpAnTv43QBrvDD6QJc4YfTDoIQGgAASX9zfwAAAABJRU5ErkJggg==">
    
    <!-- BIBLIOTHEQUES EXTERNES -->
    <!-- jsPDF -->
    
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- EN-TETE -->
        <header class="app-header">
            <div class="agent-info">
                <h1>üíâ VaxiTrack Tchad v2.0</h1>
                <p id="agent-name">Agent: <strong>Agent UNICEF</strong> | <span id="sync-status">üü¢ En ligne</span></p>
                <p id="last-sync">Derni√®re synchro: <span class="timestamp">--/--/---- --:--</span></p>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-number" id="total-vaccinations">0</span>
                    <span class="stat-label">Vaccinations</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="pending-sync">0</span>
                    <span class="stat-label">En attente</span>
                </div>
            </div>
        </header>

        <!-- NAVIGATION -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="enregistrer">‚ûï Enregistrer</button>
            <button class="tab-btn" data-tab="liste">üìã Liste</button>
            <button class="tab-btn" data-tab="rapports">üìä Rapports</button>
            <button class="tab-btn" data-tab="parametres">‚öôÔ∏è Param√®tres</button>
        </nav>

        <!-- CONTENU PRINCIPAL -->
        <main class="tab-content">
            <!-- ONGLET 1: ENREGISTREMENT -->
            <div id="enregistrer" class="tab-pane active">
                <form id="vaccination-form">
                    <div class="form-group">
                        <label for="child-name">Nom de l'enfant *</label>
                        <input type="text" id="child-name" placeholder="Ex: Mariam Mahamat" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="child-age">√Çge (mois) *</label>
                            <input type="number" id="child-age" min="0" max="60" placeholder="Ex: 12" required>
                        </div>
                        <div class="form-group">
                            <label for="child-sex">Sexe *</label>
                            <select id="child-sex" required>
                                <option value="">Choisir</option>
                                <option value="M">Masculin</option>
                                <option value="F">F√©minin</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="child-village">Village/Localit√© *</label>
                        <select id="child-village" required>
                            <option value="">S√©lectionner un village</option>
                            <!-- Rempli dynamiquement -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="vaccine-type">Vaccin administr√© *</label>
                        <select id="vaccine-type" required>
                            <option value="">S√©lectionner un vaccin</option>
                            <option value="BCG">BCG (Tuberculose)</option>
                            <option value="VPO">VPO (Polio oral)</option>
                            <option value="VPI">VPI (Polio injectable)</option>
                            <option value="PENTA">Penta (Dipht√©rie, T√©tanos, Coqueluche...)</option>
                            <option value="VAR">Rougeole</option>
                            <option value="VAA">VAA (Vitamine A)</option>
                            <option value="COVID">COVID-19</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="vaccine-date">Date de vaccination *</label>
                            <input type="date" id="vaccine-date" required>
                        </div>
                        <div class="form-group">
                            <label for="vaccine-dose">Num√©ro de dose</label>
                            <select id="vaccine-dose">
                                <option value="Dose 1">1√®re dose</option>
                                <option value="Dose 2">2√®me dose</option>
                                <option value="Dose 3">3√®me dose</option>
                                <option value="Rappel">Rappel</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="agent-notes">Notes/observations</label>
                        <textarea id="agent-notes" rows="2" placeholder="Ex: R√©action l√©g√®re, parent inform√©..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="btn-save-offline" class="btn btn-primary">
                            üíæ Sauvegarder
                        </button>
                        <button type="button" id="btn-sync-now" class="btn btn-secondary" disabled>
                            üîÑ Synchroniser
                        </button>
                    </div>
                </form>

                <div id="save-confirmation" class="confirmation" style="display: none;">
                    <p>‚úÖ Vaccination enregistr√©e localement !</p>
                    <small>Donn√©es synchronisables d√®s reconnexion.</small>
                </div>
            </div>

            <!-- ONGLET 2: LISTE -->
            <div id="liste" class="tab-pane">
                <div class="list-controls">
                    <input type="text" id="search-list" placeholder="Rechercher par nom ou village...">
                    <select id="filter-village">
                        <option value="">Tous les villages</option>
                        <!-- Rempli dynamiquement -->
                    </select>
                </div>
                <div id="vaccinations-list" class="vaccinations-list">
                    <p class="empty-state">Aucune vaccination enregistr√©e.</p>
                </div>
            </div>

            <!-- ONGLET 3: RAPPORTS -->
            <div id="rapports" class="tab-pane">
                <div class="report-header">
                    <h3>üì• T√©l√©charger des rapports</h3>
                    <p class="report-subtitle">Choisissez le rapport adapt√© √† votre besoin</p>
                </div>

                <div class="report-options">
                    <div class="report-option">
                        <div class="option-icon">üìã</div>
                        <div class="option-content">
                            <h4>Mes donn√©es compl√®tes</h4>
                            <p class="option-desc">Toutes vos vaccinations enregistr√©es</p>
                        </div>
                        <button class="btn-download" data-report="agent">
                            ‚¨áÔ∏è T√©l√©charger Excel
                        </button>
                    </div>

                    <div class="report-option">
                        <div class="option-icon">üèòÔ∏è</div>
                        <div class="option-content">
                            <h4>Statistiques par village</h4>
                            <p class="option-desc">Totaux par village : filles, gar√ßons</p>
                        </div>
                        <button class="btn-download" data-report="village">
                            ‚¨áÔ∏è T√©l√©charger Excel
                        </button>
                    </div>

                    <div class="report-option">
                        <div class="option-icon">üíâ</div>
                        <div class="option-content">
                            <h4>R√©partition par vaccin</h4>
                            <p class="option-desc">Nombre de chaque type de vaccin</p>
                        </div>
                        <button class="btn-download" data-report="vaccine">
                            ‚¨áÔ∏è T√©l√©charger Excel
                        </button>
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 30px; padding-top: 20px;">
                    <button id="btn-generate-report" class="btn btn-primary">
                        üìÑ G√©n√©rer Rapport PDF
                    </button>
                    <button id="btn-export-csv" class="btn btn-secondary">
                        üìã Exporter CSV
                    </button>
                </div>
            </div>

            <!-- ONGLET 4: PARAMETRES -->
            <div id="parametres" class="tab-pane">
                <div class="settings-section">
                    <h3>Agent</h3>
                    <div class="form-group">
                        <label for="setting-agent-name">Nom de l'agent</label>
                        <input type="text" id="setting-agent-name" placeholder="Ex: Agent UNICEF">
                    </div>
                    <div class="form-group">
                        <label for="setting-agent-id">Identifiant UNICEF</label>
                        <input type="text" id="setting-agent-id" placeholder="Ex: TCD-HEALTH-001">
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Synchronisation</h3>
                    <button id="btn-manual-sync" class="btn btn-secondary">üîÑ Synchroniser maintenant</button>
                    <button id="btn-clear-data" class="btn btn-danger">üóëÔ∏è Effacer donn√©es locales</button>
                </div>

                <div class="settings-section">
                    <h3>√Ä propos</h3>
                    <p><strong>VaxiTrack Tchad v2.0.0</strong></p>
                    <p>Application offline pour agents de sant√© UNICEF Tchad</p>
                    <p id="app-storage">Stockage utilis√©: <span>0 KB</span></p>
                </div>
            </div>
        </main>

        <!-- NOTIFICATION -->
        <div id="notification" class="notification"></div>
    </div>

    <!-- SCRIPT PRINCIPAL SEULEMENT -->
    <script src="app.js?v=2.0.0"></script>
    
    <!-- SCRIPT INITIAL SIMPLE -->
    <script>
        // Script de d√©marrage minimal
        console.log('üöÄ VaxiTrack Tchad v2.0.0 - Initialisation...');
        
        // Compteur de visites
        const visitKey = 'vaxitrack_visits_v2';
        let visits = parseInt(localStorage.getItem(visitKey)) || 0;
        visits++;
        localStorage.setItem(visitKey, visits);
        console.log(`üìä Visites: ${visits}`);
        
        // V√©rification version
        window.addEventListener('load', function() {
            console.log('‚úÖ Page compl√®tement charg√©e');
            console.log('üåê Online:', navigator.onLine);
            
            // V√©rifie si app.js a charg√© la configuration
            setTimeout(function() {
                if (window.CONFIG && window.CONFIG.VERSION === '2.0.0') {
                    console.log('‚úÖ Version 2.0.0 correctement charg√©e');
                } else {
                    console.warn('‚ö†Ô∏è Version incorrecte ou non charg√©e');
                }
            }, 1000);
        });
    </script>
</body>
</html>